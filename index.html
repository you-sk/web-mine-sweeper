<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒã‚¤ãƒ³ã‚¹ã‚¤ãƒ¼ãƒ‘ãƒ¼</title>
    <style>
        /* Google Fontsã‹ã‚‰ãƒ•ã‚©ãƒ³ãƒˆã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap');

        /* åŸºæœ¬çš„ãªã‚¹ã‚¿ã‚¤ãƒ«è¨­å®š */
        :root {
            --bg-color: #f0f2f5;
            --container-bg: #ffffff;
            --border-color: #d9d9d9;
            --cell-bg: #bdbdbd;
            --cell-bg-hover: #cccccc;
            --cell-revealed-bg: #e0e0e0;
            --primary-color: #1890ff;
            --danger-color: #f5222d;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --font-family: 'Noto Sans JP', sans-serif;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: #333;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* ä¸Šå¯„ã›ã«å¤‰æ›´ */
            min-height: 100vh;
            margin: 0;
            padding-top: 2rem; /* ä¸Šéƒ¨ã«ä½™ç™½ã‚’è¿½åŠ  */
        }

        .game-container {
            background-color: var(--container-bg);
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 8px 30px var(--shadow-color);
            text-align: center;
            width: fit-content;
            max-width: 95vw;
        }

        h1 {
            color: #333;
            margin-top: 0;
        }

        /* é›£æ˜“åº¦é¸æŠãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .difficulty-controls, .game-controls {
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            background-color: #fff;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px 20px;
            font-size: 1rem;
            font-family: var(--font-family);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px var(--shadow-color);
        }

        .btn:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px var(--shadow-color);
        }

        .btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        /* ã‚²ãƒ¼ãƒ æƒ…å ±ã‚¨ãƒªã‚¢ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .game-info {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
            color: #555;
        }
        
        .game-info span {
            color: var(--danger-color);
            margin-left: 8px;
        }

        /* ã‚²ãƒ¼ãƒ ã‚°ãƒªãƒƒãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #game-grid {
            display: grid;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            background-color: #ccc;
        }

        .cell {
            width: 30px;
            height: 30px;
            background-color: var(--cell-bg);
            border: 1px solid #9e9e9e;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            user-select: none; /* ãƒ†ã‚­ã‚¹ãƒˆé¸æŠã‚’ç„¡åŠ¹åŒ– */
            transition: all 0.1s ease-in-out;
        }

        .cell:not(.revealed):hover {
            background-color: var(--cell-bg-hover);
        }
        
        /* ã‚¯ãƒªãƒƒã‚¯æ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .cell:active:not(.revealed) {
            transform: scale(0.95);
        }

        .cell.revealed {
            background-color: var(--cell-revealed-bg);
            border-color: #bdbdbd;
            cursor: default;
        }
        
        .cell.flagged::before {
            content: 'ğŸš©';
            font-size: 1rem;
            animation: place-flag 0.2s ease-out;
        }

        .cell.mine {
            background-color: var(--danger-color);
        }
        
        .cell.mine::before {
            content: 'ğŸ’£';
            font-size: 1rem;
            animation: reveal-mine 0.3s ease;
        }

        .cell.exploded {
            background-color: #ff4d4f;
        }

        .cell.exploded::before {
             content: 'ğŸ’¥';
            font-size: 1rem;
        }

        /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®å®šç¾© */
        @keyframes place-flag {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        @keyframes reveal-mine {
             from { transform: scale(0); }
             to { transform: scale(1); }
        }

        /* æ•°å­—ã®è‰²åˆ†ã‘ */
        .cell[data-mines="1"] { color: #1976d2; }
        .cell[data-mines="2"] { color: #388e3c; }
        .cell[data-mines="3"] { color: #d32f2f; }
        .cell[data-mines="4"] { color: #7b1fa2; }
        .cell[data-mines="5"] { color: #ff8f00; }
        .cell[data-mines="6"] { color: #00897b; }
        .cell[data-mines="7"] { color: #5d4037; }
        .cell[data-mines="8"] { color: #455a64; }

        /* ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼/ã‚¯ãƒªã‚¢æ™‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        #message-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: none; /* åˆæœŸçŠ¶æ…‹ã¯éè¡¨ç¤º */
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        #message-box {
            background-color: white;
            padding: 2rem 3rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            animation: pop-in 0.3s ease-out;
        }
        
        #message-box h2 {
            margin: 0 0 1rem 0;
            font-size: 2rem;
        }

        @keyframes pop-in {
            from { transform: scale(0.7); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

    </style>
</head>
<body>

    <div class="game-container">
        <h1>ãƒã‚¤ãƒ³ã‚¹ã‚¤ãƒ¼ãƒ‘ãƒ¼</h1>

        <div class="difficulty-controls">
            <button id="btn-beginner" class="btn active">åˆç´š</button>
            <button id="btn-intermediate" class="btn">ä¸­ç´š</button>
            <button id="btn-expert" class="btn">ä¸Šç´š</button>
        </div>
        
        <div class="game-controls">
             <button id="start-btn" class="btn">ã‚²ãƒ¼ãƒ é–‹å§‹</button>
        </div>

        <div class="game-info">
            æ®‹ã‚Šåœ°é›·æ•°: <span id="mines-count">0</span>
        </div>

        <div id="game-grid"></div>

    </div>

    <div id="message-overlay">
        <div id="message-box">
            <h2 id="message-text"></h2>
            <button id="retry-btn" class="btn">ãƒªãƒˆãƒ©ã‚¤</button>
        </div>
    </div>


    <script>
        // --- DOMè¦ç´ ã®å–å¾— ---
        const gridElement = document.getElementById('game-grid');
        const minesCountElement = document.getElementById('mines-count');
        const startBtn = document.getElementById('start-btn');
        const messageOverlay = document.getElementById('message-overlay');
        const messageText = document.getElementById('message-text');
        const retryBtn = document.getElementById('retry-btn');
        const difficultyBtns = {
            beginner: document.getElementById('btn-beginner'),
            intermediate: document.getElementById('btn-intermediate'),
            expert: document.getElementById('btn-expert'),
        };

        // --- ã‚²ãƒ¼ãƒ è¨­å®š ---
        const difficulties = {
            beginner: { rows: 9, cols: 9, mines: 5 },
            intermediate: { rows: 16, cols: 16, mines: 40 },
            expert: { rows: 20, cols: 30, mines: 99 } // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¦æœ›ã«åˆã‚ã›ã¦å¤‰æ›´ (ç¸¦20 x æ¨ª30)
        };
        let currentDifficulty = 'beginner';

        // --- ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹å¤‰æ•° ---
        let board = [];
        let totalMines = 0;
        let flagsPlaced = 0;
        let revealedCells = 0;
        let isGameOver = false;
        let isFirstClick = true;

        // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š ---
        startBtn.addEventListener('click', () => {
            startGame(currentDifficulty);
        });
        
        retryBtn.addEventListener('click', () => {
            messageOverlay.style.display = 'none';
            startGame(currentDifficulty);
        });

        Object.keys(difficultyBtns).forEach(level => {
            difficultyBtns[level].addEventListener('click', () => {
                // æ—¢ã«ã‚²ãƒ¼ãƒ ãŒå§‹ã¾ã£ã¦ã„ã‚‹å ´åˆã¯é›£æ˜“åº¦å¤‰æ›´ä¸å¯
                if (!isFirstClick) return;

                // é¸æŠã•ã‚ŒãŸãƒœã‚¿ãƒ³ã« .active ã‚¯ãƒ©ã‚¹ã‚’ä»˜ä¸
                Object.values(difficultyBtns).forEach(btn => btn.classList.remove('active'));
                difficultyBtns[level].classList.add('active');
                currentDifficulty = level;

                // é›£æ˜“åº¦å¤‰æ›´æ™‚ã«ã‚²ãƒ¼ãƒ ã‚’åˆæœŸåŒ–
                startGame(currentDifficulty);
            });
        });
        
        // --- ã‚²ãƒ¼ãƒ ã®åˆæœŸåŒ–ãƒ»é–‹å§‹ ---
        function startGame(difficulty) {
            const config = difficulties[difficulty];
            
            // ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            isGameOver = false;
            isFirstClick = true;
            flagsPlaced = 0;
            revealedCells = 0;
            totalMines = config.mines;

            // UIã®æ›´æ–°
            gridElement.innerHTML = '';
            gridElement.style.gridTemplateColumns = `repeat(${config.cols}, 30px)`;
            startBtn.textContent = 'ãƒªãƒˆãƒ©ã‚¤'; // é–‹å§‹å¾Œã¯ãƒªãƒˆãƒ©ã‚¤ã«è¡¨ç¤ºå¤‰æ›´
            minesCountElement.textContent = totalMines;
            
            // ãƒœãƒ¼ãƒ‰ã®å†…éƒ¨è¡¨ç¾ã‚’ä½œæˆ
            board = Array.from({ length: config.rows }, () => 
                Array.from({ length: config.cols }, () => ({
                    isMine: false,
                    isRevealed: false,
                    isFlagged: false,
                    adjacentMines: 0
                }))
            );

            // ã‚°ãƒªãƒƒãƒ‰ã‚’ç”»é¢ä¸Šã«æç”»
            createGrid(config.rows, config.cols);
        }

        // --- ã‚°ãƒªãƒƒãƒ‰ã®æç”» ---
        function createGrid(rows, cols) {
            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    const cellElement = document.createElement('div');
                    cellElement.classList.add('cell');
                    cellElement.dataset.row = r;
                    cellElement.dataset.col = c;
                    
                    // å·¦ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
                    cellElement.addEventListener('click', () => handleCellClick(r, c));
                    // å³ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
                    cellElement.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        handleRightClick(r, c);
                    });

                    gridElement.appendChild(cellElement);
                }
            }
        }

        // --- å·¦ã‚¯ãƒªãƒƒã‚¯å‡¦ç† ---
        function handleCellClick(row, col) {
            if (isGameOver) return;
            const cell = board[row][col];
            if (cell.isRevealed || cell.isFlagged) return;

            // æœ€åˆã®ã‚¯ãƒªãƒƒã‚¯ã®å ´åˆã€åœ°é›·ã‚’é…ç½®
            if (isFirstClick) {
                placeMines(row, col);
                isFirstClick = false;
            }

            // åœ°é›·ã‚’è¸ã‚“ã å ´åˆ
            if (cell.isMine) {
                gameOver(false, row, col);
                return;
            }

            revealCell(row, col);
            checkWin();
        }

        // --- å³ã‚¯ãƒªãƒƒã‚¯å‡¦ç† (æ——ã®è¨­ç½®/è§£é™¤) ---
        function handleRightClick(row, col) {
            if (isGameOver) return;
            const cell = board[row][col];
            if (cell.isRevealed) return;

            cell.isFlagged = !cell.isFlagged;
            flagsPlaced += cell.isFlagged ? 1 : -1;
            
            updateUI();
            checkWin(); // æ——ã‚’ç«‹ã¦ãŸã ã‘ã§ã‚¯ãƒªã‚¢ã«ãªã‚‹å ´åˆãŒã‚ã‚‹
        }
        
        // --- åœ°é›·ã®é…ç½® ---
        function placeMines(firstClickRow, firstClickCol) {
            const { rows, cols } = difficulties[currentDifficulty];
            let minesToPlace = totalMines;

            while (minesToPlace > 0) {
                const r = Math.floor(Math.random() * rows);
                const c = Math.floor(Math.random() * cols);

                // æœ€åˆã®ã‚¯ãƒªãƒƒã‚¯ç®‡æ‰€ã¨åœ°é›·ãŒæ—¢ã«å­˜åœ¨ã™ã‚‹ãƒã‚¹ã¯é¿ã‘ã‚‹
                if (r === firstClickRow && c === firstClickCol) continue;
                if (board[r][c].isMine) continue;

                board[r][c].isMine = true;
                minesToPlace--;
            }

            // å„ãƒã‚¹ã®å‘¨å›²ã®åœ°é›·æ•°ã‚’è¨ˆç®—
            calculateAdjacentMines();
        }

        // --- å‘¨å›²ã®åœ°é›·æ•°ã‚’è¨ˆç®— ---
        function calculateAdjacentMines() {
             const { rows, cols } = difficulties[currentDifficulty];
             for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    if (board[r][c].isMine) continue;
                    let count = 0;
                    for (let dr = -1; dr <= 1; dr++) {
                        for (let dc = -1; dc <= 1; dc++) {
                            if (dr === 0 && dc === 0) continue;
                            const nr = r + dr;
                            const nc = c + dc;
                            if (nr >= 0 && nr < rows && nc >= 0 && nc < cols && board[nr][nc].isMine) {
                                count++;
                            }
                        }
                    }
                    board[r][c].adjacentMines = count;
                }
            }
        }
        
        // --- ãƒã‚¹ã‚’é–‹ãå‡¦ç† (é€£é–ã‚ªãƒ¼ãƒ—ãƒ³ã‚‚å«ã‚€) ---
        function revealCell(row, col) {
            const { rows, cols } = difficulties[currentDifficulty];
            if (row < 0 || row >= rows || col < 0 || col >= cols) return;

            const cell = board[row][col];
            if (cell.isRevealed || cell.isFlagged) return;

            cell.isRevealed = true;
            revealedCells++;
            
            const cellElement = document.querySelector(`[data-row='${row}'][data-col='${col}']`);
            cellElement.classList.add('revealed');

            if (cell.adjacentMines > 0) {
                cellElement.textContent = cell.adjacentMines;
                cellElement.dataset.mines = cell.adjacentMines;
            } else {
                // å‘¨å›²ã®åœ°é›·ãŒ0ãªã‚‰ã€éš£æ¥ã™ã‚‹ãƒã‚¹ã‚‚é–‹ã (é€£é–ã‚ªãƒ¼ãƒ—ãƒ³)
                for (let dr = -1; dr <= 1; dr++) {
                    for (let dc = -1; dc <= 1; dc++) {
                        if (dr === 0 && dc === 0) continue;
                        revealCell(row + dr, col + dc);
                    }
                }
            }
        }

        // --- UIã®æ›´æ–° ---
        function updateUI() {
            const { rows, cols } = difficulties[currentDifficulty];
            minesCountElement.textContent = totalMines - flagsPlaced;

            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    const cell = board[r][c];
                    const cellElement = document.querySelector(`[data-row='${r}'][data-col='${c}']`);
                    
                    cellElement.classList.toggle('flagged', cell.isFlagged);

                    if (isGameOver && cell.isMine && !cell.isFlagged) {
                        cellElement.classList.add('mine');
                    }
                }
            }
        }
        
        // --- å‹åˆ©åˆ¤å®š ---
        function checkWin() {
            const { rows, cols } = difficulties[currentDifficulty];
            const totalNonMineCells = rows * cols - totalMines;

            // åœ°é›·ä»¥å¤–ã®ãƒã‚¹ãŒã™ã¹ã¦é–‹ã‹ã‚ŒãŸã‚‰å‹åˆ©
            if (revealedCells === totalNonMineCells) {
                gameOver(true);
            }
            // ã¾ãŸã¯ã€ã™ã¹ã¦ã®åœ°é›·ã«æ——ãŒç«‹ã¦ã‚‰ã‚Œã€ã‹ã¤åœ°é›·ã§ãªã„ãƒã‚¹ãŒå…¨ã¦é–‹ã‹ã‚ŒãŸå ´åˆ
            // â€»ã“ã®ãƒ­ã‚¸ãƒƒã‚¯ã¯ä»•æ§˜æ›¸ã«ã‚ã‚Šã¾ã™ãŒã€revealedCellsã®ãƒã‚§ãƒƒã‚¯ã§ç¶²ç¾…ã§ãã¾ã™ã€‚
            // æ——ã®æ•°ãŒåœ°é›·ã®ç·æ•°ã¨ä¸€è‡´ã—ã€ã‹ã¤é–‹ã„ãŸãƒã‚¹ã®æ•°ãŒæ­£ã—ã‘ã‚Œã°å‹åˆ©ã¨ã„ã†åˆ¤å®šã‚‚å¯èƒ½ã§ã™ã€‚
        }

        // --- ã‚²ãƒ¼ãƒ çµ‚äº†å‡¦ç† ---
        function gameOver(isWin, clickedRow = -1, clickedCol = -1) {
            if (isGameOver) return;
            isGameOver = true;
            
            if (isWin) {
                messageText.textContent = 'ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢ï¼ ğŸ‰';
                messageText.style.color = 'var(--primary-color)';
            } else {
                messageText.textContent = 'ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼';
                messageText.style.color = 'var(--danger-color)';
                // ã™ã¹ã¦ã®åœ°é›·ã‚’è¡¨ç¤º
                const { rows, cols } = difficulties[currentDifficulty];
                for (let r = 0; r < rows; r++) {
                    for (let c = 0; c < cols; c++) {
                        if (board[r][c].isMine) {
                            const cellEl = document.querySelector(`[data-row='${r}'][data-col='${c}']`);
                             if (r === clickedRow && c === clickedCol) {
                                cellEl.classList.add('exploded');
                            } else {
                                cellEl.classList.add('mine');
                            }
                        }
                    }
                }
            }
            messageOverlay.style.display = 'flex';
        }

        // --- åˆæœŸã‚²ãƒ¼ãƒ ã®é–‹å§‹ ---
        startGame(currentDifficulty);
    </script>
</body>
</html>
